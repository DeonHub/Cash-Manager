<!DOCTYPE html>
<html>
    <head>
      <meta charset="utf-8" >
      <meta name="viewport" content="width=device-width">

      <link rel="icon" href="images/favicon.ico" type="image/ico" >

      <title>Fees Management System </title>

        {% load static %}
        <link rel="icon" href="{% static 'login/media/favicon.png' %}" type="image/jpg" />
        <link rel="icon" href="{% static 'login/media/icon-48x48.png' %}" type="image/jpg" />
        <link rel="icon" href="{% static 'login/media/icon-72x72.png' %}" type="image/jpg" />
        <link rel="icon" href="{% static 'login/media/icon-96x96.png' %}" type="image/jpg" />
        <link rel="icon" href="{% static 'login/media/icon-144x144.png' %}" type="image/jpg" />
        <link rel="icon" href="{% static 'login/media/icon-192x192.png' %}" type="image/jpg" />
    
        <meta name="apple-mobile-web-app-status-bar" content="#f7941d">
        <meta name="theme-color" content="#f7941d">

        <link rel="manifest" href="{% static 'login/js/manifest.webmanifest' %}" />
        <script src="{% static 'client/js/script.js' %}"></script>
        <script src="{% static 'superuser/js/script.js' %}"></script>
        <script src="{% static 'client/js/side.js' %}"></script>
        <link rel="icon" href="{% static 'superuser/media/favicon.jpg' %}" type="image/jpg" />

        <link rel="stylesheet" href="{% static 'client/css/style.css' %}" media="all">
        <link rel="stylesheet" href="{% static 'client/css/side.css' %}" media="all">
        <link rel="stylesheet" href="{% static 'client/css/styles.css' %}" media="all">
       {% comment %} <link rel="stylesheet" href="{% static 'superuser/css/style.css' %}" media="all">
        <link rel="stylesheet" href="{% static 'superuser/css/side.css' %}" media="all">
        <link rel="stylesheet" href="{% static 'superuser/css/styles.css' %}" media="all">  {% endcomment %}

        <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>

        <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css " />

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> 
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

        <style>
          {% block style %}
          
          {% endblock %}
        </style>
    </head>

    <body>

      <div class="d-flex" id="wrapper">
        
        {% comment %} <!-- Sidebar--> {% endcomment %}
        <div class="border-end" id="sidebar-wrapper">
            {% comment %} <div class="sidebar-heading border-bottom text-center"><a  href="{% url 'client:index' %}">Fee Management System</a></div> {% endcomment %}
            <div class="sidebar-heading border-bottom text-center"><a href="{% url 'client:index' mid=mid %}">
              <img src="{% static 'superuser/media/aks.jpg' %}" alt="logo" /></a></div>
              <div class="text-center mt-3 mb-3">
                {{ dated }}<br/>
                {{ time }}
              </div>
          
            <hr/>

            <div class="list-group list-group-flush">
                <a class="list-group-item list-group-item-action" href="{% url 'client:index' mid=mid %}"><span class="material-symbols-outlined">speed</span><p>Dashboard</p></a>
                <a class="list-group-item list-group-item-action" href="{% url 'client:viewAssignedPayments' mid=mid %}"><span class="material-symbols-outlined">view_kanban</span><p>Assigned Payments</p></a>
                <a class="list-group-item list-group-item-action" href="{% url 'client:viewPayments' mid=mid %}"><span class="material-symbols-outlined">list_alt</span><p>Payment Records</p></a>

            </div>
        </div>


        {% comment %} <!-- Page content wrapper--> {% endcomment %}
        <div id="page-content-wrapper">

            {% comment %} <!-- Top navigation--> {% endcomment %}
            <nav class="navbar navbar-expand-lg navbar-light bg-dark border-bottom">
              <div class="container-fluid">
                  <button class="btn btn-sm" id="sidebarToggle" style="background-color: #f7941d"><span class="material-symbols-outlined">menu</span></button>
                  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>

                  <div class="d-flex flex-column ml-3 mt-3 mb-1 text-light demo" id="demo" style="text-align: center;width:100%;">
                    <h4>{{ member_account_name }}</h4>
                    <h6>Branch: {{ member_branch }}</h6>
                  </div>
                  
                  <div class="collapse navbar-collapse" id="navbarSupportedContent">
                      <ul class="navbar-nav ms-auto mt-2 mt-lg-0">
                        

                          <li class="nav-item dropdown">

                            <div class="dropdown" >
                              <button class="btn btn-light btn-sm dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false" >
                                <span class="material-symbols-outlined">account_circle</span>
                              </button>
                              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                <li><a class="dropdown-item" href="{% url 'client:viewProfile' mid=mid %}">Profile</a></li>
                                <div class="dropdown-divider"></div> 

                                <li><a class="dropdown-item" href="{% url 'client:logout' mid=mid %}" onclick="memberOut()">Log Out</a></li>
                              </ul>
                            </div>

                          </li>
                      </ul>
                  </div>
              </div>
          </nav>


            {% comment %} <!-- Page content--> {% endcomment %}
            <div class="container-fluid">

              
                {% block content %}

                {% endblock %}
            </div>
 
        </div>

    </div>

 


{% comment %} 
      <footer>
          <div class="pull-right">
              Gentelella - Bootstrap Admin Template by <a href="https://colorlib.com">Colorlib</a>
          </div>
          <div class="clearfix"></div>
      </footer> {% endcomment %}


    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>

    <script>
      {% if setItem == True %}

        window.localStorage.setItem('token', '1fe8480feff19495f8799e2133d7e60fe8a7628fdbe9416e467343a49978d3c5');
    
      {% endif %}
    </script>


    <script>
      {% if messages %}
        {% for msg in messages %}
          swal('{{ msg }}');

        {% endfor %}

      window.localStorage.setItem('token', '1fe8480feff19495f8799e2133d7e60fe8a7628fdbe9416e467343a49978d3c5');
      {% endif %}

    </script>


<script>










  $(document).ready(function () {
  
    $('#client_payments').DataTable({
      pagingType: 'full_numbers',
    });
  
  });

  $(document).ready(function () {
  
    $('#payments').DataTable({
      pagingType: 'full_numbers',
    });
  
  });
  
  {% comment %} 
  $(document).ready(function () {
  
    $('#assigned_payments').DataTable({
      pagingType: 'full_numbers',
    });
  
  });
  

  
  $(document).ready(function () {
  
    $('#all_payments').DataTable({
      pagingType: 'full_numbers',
    });
  
  });
   {% endcomment %}

  {% comment %} 
  $(document).ready(function () {
    
    $('#archived_table').DataTable({
      pagingType: 'full_numbers',
    });
  
  });
  
  $(document).ready(function () {
    
    $('#payment_history').DataTable({
      pagingType: 'full_numbers',
    });
  
  });
  
  $(document).ready(function () {
    
    $('#module_fees').DataTable({
      pagingType: 'full_numbers',
    });
  
  });
  
  $(document).ready(function () {
    
    $('#active_fees').DataTable({
      pagingType: 'full_numbers',
    });
  
  });
  
  $(document).ready(function () {
    
    $('#special_history').DataTable({
      pagingType: 'full_numbers',
    });
  
  });
  
  $(document).ready(function () {
    
    $('#payment_details').DataTable({
      pagingType: 'full_numbers',
    });
  
  });
  
  $(document).ready(function () {
    
    $('#sizes').DataTable({
      pagingType: 'full_numbers',
    });
  
  });
   {% endcomment %}
  












   $(document).ready(function(){

    $('#payment_submit').click(function(e){
  
      e.preventDefault()

      var member = $('#member').val();
      var member_id = $(this).attr('data-member-id');

      var url = $(this).attr('data-url');
      var csrf = $('input[name=csrfmiddlewaretoken]').val()

      var amount_paid = $('#amount_paid').val();

      var client_id = $(this).attr('data-client-id');
      var invoice_id = $(this).attr('data-pk');
      
  
      var branch = $('#branch').val();
      var member_category = $('#member_category').val();
      var group = $('#group').val();
      var subgroup = $('#subgroup').val();


      var fee_type = $('#fee_type').val();
      var fee_description = $('#fee_description').val();


      var outstanding_bill = $('#outstanding_bill').val();
      var remarks = $('#remarks').val();
      var user_type = $('#user_type').val();
      var assigned_duration = $('#assigned_duration').val();
      var expiration_bill = $('#expiration_bill').val();
      // var client_id = $('#client_id').val();
      var install_range = $('#install_range').val();
      var install_period = $('#install_period').val();
      var total_amount_due = $('#total_amount_due').val();
      var outstanding_balance = $('#outstanding_balance').val();
      
      var payment_status = $('#payment_status').val();
      var end_date = $('#end_date').val();
      var arrears = $('#arrears').val();

  
       //alert(url)
  
      //alert(amount)
  
      if(confirm("\tAre you sure you want to proceed to payment? \nYou'll have a maximum of 5 minutes to make payment")){
  
       //alert("Submitting")
  
  
       $.ajax({
        url: url,
        method: "POST",
        data: {
            member,
            member_id,
            amount_paid,
           
            client_id,
            invoice_id,
            branch,
            member_category,
            group,
            subgroup,
            fee_type,
            fee_description,

            outstanding_bill,
            remarks,
            user_type,
            assigned_duration,
            expiration_bill,
            install_range,
            install_period,
            total_amount_due,
            outstanding_balance,
            
            payment_status,
            end_date,
            arrears,

            
            csrfmiddlewaretoken: csrf
        }
      }).done(function(data){
    
            // alert("Done")
            alert("Done")
            window.location.href = data;
            // e.preventDefault()
  
  
          }).fail(function(data){
            alert("Something went wrong")
  
            console.log(data)
  
          })
  
  
        }
  
  
    })
    })
  
  















  $(document).ready(function(){
    $('#delete_button').click(function(){
      var id = [];
      var url = $("#delete_button").attr("data-delete-url");
      var csrf = $('input[name=csrfmiddlewaretoken]').val()

      $(':checkbox:checked').each(function(i){
        id[i]=$(this).val()
      })

      if(id.length == 0){
        alert("Please select item to delete")
      }
      else{
        if(confirm("Are you sure you want to delete this item?")){

          $.ajax({
            url: url,
            method: "POST",
            data: {
              id,
              csrfmiddlewaretoken: csrf
            },
            success: function(response){
              for(var i=0; i<id.length; i++){
                $('tr#'+id[i]+'').css('background-color', '#ccc');
                $('tr#'+id[i]+'').fadeOut('slow');
              }
            } 
          })   
    }

  }
  })
})



$(document).ready(function(){
  $('#delete_assigned').click(function(){
    var id = [];
    var url = $("#delete_assigned").attr("data-remove-url");
    var csrf = $('input[name=csrfmiddlewaretoken]').val()
    $(':checkbox:checked').each(function(i){
      id[i]=$(this).val()
    })

    if(id.length == 0){
      alert("Please select item to delete")
    }
    else{
      if(confirm("Are you sure you want to delete this item?")){

        $.ajax({
          url: url,
          method: "POST",
          data: {
            id,
            csrfmiddlewaretoken: csrf
          },
          success: function(response){
            for(var i=0; i<id.length; i++){
              $('tr#'+id[i]+'').css('background-color', '#ccc');
              $('tr#'+id[i]+'').fadeOut('slow');
            }
          } 
        })   
  }
}
})
})

</script>



<script>
  $("#user_member").change(function () {
     var url = $("#makePaymentForm").attr("data-fee-url");
     var member = $(this).val();

     $.ajax({
       url: url,
       data: {
         'member': member,
       },
       success: function (data) {
         $("#fee_type").html(data);
       }
     });
 
   });
 
 </script>



<script>
  $("#fee_type").change(function () {
     var url = $("#makePaymentForm").attr("data-balance-url");
     var member = $("#user_member").val();
     var fee_type = $(this).val();
 
     $.ajax({
       url: url,
       data: {
         'fee_type': fee_type,
         'member': member,
       },
       success: function (data) {
         $("#user_type").html(data);
       }
     });
 
   });
   
 </script>




<script>

  $("#fee_type").change(function () {
    var url = $("#assignPaymentForm").attr("data-invoice-url");
    var branch = $("#branch").val();
    var member_category = $("#member_category").val();
    var group = $("#group").val();
    var subgroup = $("#subgroup").val();

    var fee_type = $(this).val();

    $.ajax({
      url: url,
      data: {
        'branch': branch,
        'member_category': member_category,
        'group': group,
        'subgroup': subgroup,
        'fee_type': fee_type,
      },
      success: function (data) {
         // alert(data)
         $("#total").val(data);
      }
    });

});

$(document).ready(function(){
  $("#numver").change(function () {
    var url = $("#paymentForm").attr("data-amount-url");
    var id = $("#paymentForm").attr("data-id");
    var range = $('input[name="install_range"]:checked').val();
  //  var range = $(".range").val();
  
    var period = $(this).val();

    $.ajax({
      url: url,
      data: {
        'id': id,
        'range': range,
        'period': period,
      },
      success: function (data) {
         // alert(data)
         $("#total_amount_due").val(data);
      }
    });

});

})



$(document).ready(function(){
  $("#payment_status").change(function () {
    var url = $("#paymentForm").attr("data-credit-url");
    var member = $("#member").val();
    var paid = $("#paid")
    var total_amount_due = $("#total_amount_due")

    $.ajax({
      url: url,
      data: {
        'member': member,

      },
      success: function (data) {
         // alert(data)
         $("#balance").val(data);

         $("#paid").val(parseInt($("#total_amount_due").val()) - parseInt(data))
         if(parseInt($("#paid").val()) < 0){
          $("#paid").val(0)
          }
      }
    });

});

})



$(document).ready(function(){
  $("#numver").change(function () {
    var url = $("#paymentForm").attr("data-credit-url");
    var member = $("#member").val();
    var paid = $("#paid")
    var total_amount_due = $("#total_amount_due")

    $.ajax({
      url: url,
      data: {
        'member': member,

      },
      success: function (data) {
         // alert(data)
         $("#balance").val(data);

         $("#paid").val(parseInt($("#total_amount_due").val()) - parseInt(data))
         if(parseInt($("#paid").val()) < 0){
          $("#paid").val(0)
          }
      }
    });

});

})


$(document).ready(function(){
  if (!localStorage.getItem("token")){
    window.location.href = '/';
  }
  
})


$(document).ready(function(){

  $("#year_range").change(function(){
    var year_range=$(this).val();
  
    window.location.href="?year_range="+year_range
  
  })
  })


  
$(document).ready(function(){

  // Open Popup
  $('[popup-open]').on('click', function() {
      var popup_name = $(this).attr('popup-open');
      var assigned_id = $(this).attr('data-id');
      var url = $(this).attr('data-url');

      $.ajax({
        url: url,
        data: {
          'assigned_id': assigned_id,
        },
        success: function (data) {
          $("#desc").html(data);
        }
      });
      
      
$('[popup-name="' + popup_name + '"]').fadeIn(300);
  });

  // Close Popup
  $('[popup-close]').on('click', function() {
var popup_name = $(this).attr('popup-close');
$('[popup-name="' + popup_name + '"]').fadeOut(300);
  });

  // Close Popup When Click Outside
  $('.popup').on('click', function() {
var popup_name = $(this).find('[popup-close]').attr('popup-close');
$('[popup-name="' + popup_name + '"]').fadeOut(300);
  }).children().click(function() {
return false;
  });

})

 </script>

    </body>
</html>


